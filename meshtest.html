<!DOCTYPE html>
<html lang="en">

<head>
    <title>three.js vr - layers</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
</head>

<body>

    <div id="info">
        <a href="https://threejs.org" target="_blank" rel="noopener">three.js</a>

        <br />

        <p> ‚≠ê Experimenting to see if we can use gpu compressed texture for our webxr layers. </p>
        <p> üòø This is hurting my noob brain</p>
        <p> ü•Ö Goal create two webxr quad layers.</p>
        <p> * One with an rgb data source </p>
        <p> * The other whose source will be a gpu compressed texture</p>



        <br />

    </div>

    <script src="./encoder/build/basis_loader.js"></script>

    <script type="importmap">
			{
			  "imports": {
				"three": "./three.js-master/three.js-master/build/three.module.js",
				"three/addons/": "./three.js-master/three.js-master/examples/jsm/"
			  }
			}
    </script>

    <script defer type="module">
        import * as THREE from 'three';
        import { GUI } from 'three/addons/libs/lil-gui.module.min.js';
        import { HTMLMesh } from 'three/addons/interactive/HTMLMesh.js';
        import { InteractiveGroup } from 'three/addons/interactive/InteractiveGroup.js';
        import { VRButton } from 'three/addons/webxr/VRButton.js';
        import { XRControllerModelFactory } from 'three/addons/webxr/XRControllerModelFactory.js';
        import { XRHandModelFactory } from 'three/addons/webxr/XRHandModelFactory.js';
        import { KTX2Loader } from 'three/addons/loaders/KTX2Loader.js';

        let camera, scene, renderer;
        // let stats, statsMesh;

        init();

        function init() {

            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 0.1, 10);
            camera.position.set(0, 1.6, 3);
            THREE.ColorManagement.enabled = true;

            const hemLight = new THREE.HemisphereLight(0x808080, 0x606060, 3);
            const light = new THREE.DirectionalLight(0xffffff, 3);
            scene.add(hemLight, light);


            renderer = new THREE.WebGLRenderer({ antialias: true });

            window.renderer = renderer

            renderer.setPixelRatio(window.devicePixelRatio);
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setAnimationLoop(animate);
            renderer.setClearAlpha(1);
            renderer.setClearColor(new THREE.Color(0), 0);
            renderer.xr.enabled = true;

            document.body.appendChild(renderer.domElement);
            document.body.appendChild(VRButton.createButton(renderer));

            let imageDataUrl;




            // controllers
            const lineGeometry = new THREE.BufferGeometry().setFromPoints([
                new THREE.Vector3(0, 0, 0),
                new THREE.Vector3(0, 0, - 10)
            ]);
            const line = new THREE.Line(lineGeometry, new THREE.LineBasicMaterial({ color: 0x5555ff }));


            line.renderOrder = 1;

            const controllerModelFactory = new XRControllerModelFactory();
            const handModelFactory = new XRHandModelFactory().setPath('./models/fbx/');

            //

            const controllers = [
                renderer.xr.getController(0),
                renderer.xr.getController(1)
            ];


       
            controllers.forEach((controller, i) => {

                const controllerGrip = renderer.xr.getControllerGrip(i);
                controllerGrip.add(controllerModelFactory.createControllerModel(controllerGrip));
                scene.add(controllerGrip);

                const hand = renderer.xr.getHand(i);
                hand.add(handModelFactory.createHandModel(hand));

                controller.add(line.clone());
                scene.add(controller, controllerGrip, hand);

            });


            const group = new InteractiveGroup();
            group.listenToXRControllerEvents(controllers[0]);
            group.listenToXRControllerEvents(controllers[1]);
            scene.add(group);

            //create htmlmesh

            // Create the HTML button
            const button = document.createElement('button');
            button.innerText = 'Click Me';
            button.style.position = 'absolute';
            button.style.left = '50%';
            button.style.top = '50%';
            button.style.transform = 'translate(-50%, -50%)';
            button.style.zIndex = 1;
            document.body.appendChild(button);

            // Create an HTMLMesh to attach the button to the plane
            const mesh = new HTMLMesh(button);
            mesh.position.x = - 0.75;
            mesh.position.y = 1.5;
            mesh.position.z = - 0.5;
            mesh.rotation.y = Math.PI / 4;
            mesh.scale.setScalar(2);
            group.add(mesh);
            scene.add(mesh);


            // Handle button click
            button.addEventListener('click', () => {
                console.log('Hello, World!');
            });

            group.add(mesh);


            window.addEventListener('resize', onWindowResize, false);




        }


        function onWindowResize() {

            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();

            renderer.setSize(window.innerWidth, window.innerHeight);

        }







        function animate(t, frame) {

            renderer.render(scene, camera);
        }






    </script>

    <script>


    </script>